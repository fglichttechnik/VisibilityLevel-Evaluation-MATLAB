function struct2xml(str, dir_name)
%AUTHOR: Jan Winter, Sandy Buschmann, Robert Franke TU Berlin, FG Lichttechnik,
%	j.winter@tu-berlin.de, www.li.tu-berlin.de
%LICENSE: free to use at your own risk. Kudos appreciated.
%
% Writes meta data from struct into xml file.
% 
% Input: str        = struct generated by function mat2struct
%        dir_name   = target directory where xml file will be saved


% write
xml_name = 'LMKSetMat';
xml_path = [dir_name, '\', xml_name, '.xml'];

xDoc = com.mathworks.xml.XMLUtils.createDocument(xml_name, xml_name,...
        'SYSTEM', [xml_name, '.dtd'] );
docRootNode = xDoc.getDocumentElement; 

% write Description elements to doc node:
Description_node = xDoc.createElement(str(1,2).Children(1,2).Name);
docRootNode.appendChild(Description_node);
[k, l] = size(str(1,2).Children(1,2).Children);
for h = 2 : 2 : l
    nodeName = str(1,2).Children(1,2).Children(1,h).Name;
    node = xDoc.createElement(nodeName);
    attrName = str(1,2).Children(1,2).Children(1,h).Attributes.Name;
    attr1 = xDoc.createAttribute(attrName);
    attrValue = num2str(str(1,2).Children(1,2).Children(1,h).Attributes.Value);
    attr1.setNodeValue(attrValue);
    node.setAttributeNode(attr1);
    Description_node.appendChild(node);
end   

% Write LMKData elements to doc node:
[m, n] = size(str(1,2).Children);
for i = 4 : 2 : n
    LMKDataName = str(1,2).Children(1,i).Name;
    LMKData_node = xDoc.createElement(LMKDataName);
    docRootNode.appendChild(LMKData_node);
    
        dataSource_node = xDoc.createElement(str(1,2).Children(1,i).Children...
            (1,2).Name);    
                dataSource_attr1 = xDoc.createAttribute(str(1,2).Children...
                    (1,i).Children(1,2).Attributes(1,1).Name);
                dataSource_attr1.setNodeValue(str(1,2).Children(1,i).Children...
                    (1,2).Attributes(1,1).Value);
                dataSource_node.setAttributeNode(dataSource_attr1);            
                dataSource_attr2 = xDoc.createAttribute(str(1,2).Children...
                    (1,i).Children(1,2).Attributes(1,2).Name);
                dataSource_attr2.setNodeValue(str(1,2).Children(1,i).Children...
                    (1,2).Attributes(1,2).Value);
                dataSource_node.setAttributeNode(dataSource_attr2);
        LMKData_node.appendChild(dataSource_node);

        RectObject_node = xDoc.createElement(str(1,2).Children(1,i).Children...
            (1,4).Name);    
            upperLeft_node = xDoc.createElement(str(1,2).Children...
                (1,i).Children(1,4).Children(1,2).Name);
                upperLeft_attr1 = xDoc.createAttribute(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,2).Attributes(1,1).Name);
                upperLeft_attr1.setNodeValue(num2str(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,2).Attributes(1,1).Value));
                upperLeft_node.setAttributeNode(upperLeft_attr1);
                upperLeft_attr2 = xDoc.createAttribute(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,2).Attributes(1,2).Name);
                upperLeft_attr2.setNodeValue(num2str(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,2).Attributes(1,2).Value));
                upperLeft_node.setAttributeNode(upperLeft_attr2);    
            RectObject_node.appendChild(upperLeft_node);

            lowerRight_node = xDoc.createElement(str(1,2).Children...
                (1,i).Children(1,4).Children(1,4).Name);
                lowerRight_attr1 = xDoc.createAttribute(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,4).Attributes(1,1).Name);
                lowerRight_attr1.setNodeValue(num2str(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,4).Attributes(1,1).Value));
                lowerRight_node.setAttributeNode(lowerRight_attr1);
                lowerRight_attr2 = xDoc.createAttribute(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,4).Attributes(1,2).Name);
                lowerRight_attr2.setNodeValue(num2str(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,4).Attributes(1,2).Value));
                lowerRight_node.setAttributeNode(lowerRight_attr2); 
            RectObject_node.appendChild(lowerRight_node); 

            border_node = xDoc.createElement(str(1,2).Children(1,i).Children...
                (1,4).Children(1,6).Name);
                border_attr = xDoc.createAttribute(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,6).Attributes.Name);
                border_attr.setNodeValue(num2str(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,6).Attributes.Value));
                border_node.setAttributeNode(border_attr); 
            RectObject_node.appendChild(border_node); 

            position_node = xDoc.createElement(str(1,2).Children...
                (1,i).Children(1,4).Children(1,8).Name); 
                position_attr = xDoc.createAttribute(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,8).Attributes.Name);
                position_attr.setNodeValue(num2str(str(1,2).Children...
                    (1,i).Children(1,4).Children(1,8).Attributes.Value));
                position_node.setAttributeNode(position_attr); 
            RectObject_node.appendChild(position_node);         
        LMKData_node.appendChild(RectObject_node);
end
xmlwrite(xml_path, xDoc);

end