function theStruct = mat2struct(filename)
%author Sandy Buschmann, Jan Winter TU Berlin
%email j.winter@tu-berlin.de
%
% Converts .mat-data of class LMK_measurement into a struct that fits with
% the struct generated by function parseXML.

if isempty(strfind(filename, '.mat'))
    S.elements{1,1} = filename;
else
    S = load(filename);
end

str(1,1).Name = '';

str(1,1).Children = struct('Name', {}, ...
    'Attributes', {}, ...
    'Data', {}, ...
    'Children', {});

str(1,2).Name = 'LMKSetMat';

n = size(S.elements);

str(1,2).Children = struct('Name', {}, ...
    'Attributes', {}, ...
    'Data', {}, ...
    'Children', {});

for i = 2 : 2 : n*2
    j = i/2;
    k = i+2;
    
    str(1,2).Children(1,i).Name = 'Description';
            str(1,2).Children(1,i).Children = struct('Name', {}, ...
            'Attributes', {}, ...
            'Data', {}, ...
            'Children', {});
            str(1,2).Children(1,i).Children(1,2).Name = 'SceneTitle';
                str(1,2).Children(1,i).Children(1,2).Attributes(1,1).Name = ...
                'Title';
                    str(1,2).Children(1,i).Children(1,2).Attributes(1,1).Value = ...
                    S.elements{j,1}.sceneTitle;
            str(1,2).Children(1,i).Children(1,4).Name = 'FocalLength';
                str(1,2).Children(1,i).Children(1,4).Attributes(1,1).Name = ...
                'FL';
                    str(1,2).Children(1,i).Children(1,4).Attributes(1,1).Value = ...
                    S.elements{j,1}.focalLength;
            str(1,2).Children(1,i).Children(1,6).Name = 'ViewPoint';
                str(1,2).Children(1,i).Children(1,6).Attributes(1,1).Name = ...
                'Distance';   
                    str(1,2).Children(1,i).Children(1,6).Attributes(1,1).Value = ...
                    S.elements{j,1}.viewPointDistance;           
            str(1,2).Children(1,i).Children(1,8).Name = 'Target';
                str(1,2).Children(1,i).Children(1,8).Attributes(1,1).Name = ...
                'Size';
                    str(1,2).Children(1,i).Children(1,8).Attributes(1,1).Value = ...
                    S.elements{j,1}.targetSize;             
            str(1,2).Children(1,i).Children(1,10).Name = 'ScotopicToPhotopicRatio';
                str(1,2).Children(1,i).Children(1,10).Attributes(1,1).Name = ...
                'SPRatio';
                    str(1,2).Children(1,i).Children(1,10).Attributes(1,1).Value = ...
                    S.elements{j,1}.SPRatio;                
            str(1,2).Children(1,i).Children(1,12).Name = 'Pole';
                str(1,2).Children(1,i).Children(1,12).Attributes(1,1).Name = ...
                'NumPoleFields';
                    str(1,2).Children(1,i).Children(1,12).Attributes(1,1).Value = ...
                    S.elements{j,1}.numPoleFields;  
            
            
    str(1,2).Children(1,k).Name = 'LMKData';
    
        str(1,2).Children(1,k).Children = struct('Name', {}, ...
            'Attributes', {}, ...
            'Data', {}, ...
            'Children', {});

        str(1,2).Children(1,k).Children(1,2).Name = 'dataSource';

            str(1,2).Children(1,k).Children(1,2).Attributes(1,1).Name = ...
                'src';
           
            str(1,2).Children(1,k).Children(1,2).Attributes(1,1).Value = ...
                S.elements{j,1}.dataSRCMat;

            str(1,2).Children(1,k).Children(1,2).Attributes(1,2).Name = ...
                'type';
            str(1,2).Children(1,k).Children(1,2).Attributes(1,2).Value = ...
                S.elements{j,1}.dataTypeMat;        
            
        str(1,2).Children(1,k).Children(1,4).Name = 'RectObject';
                
                str(1,2).Children(1,k).Children(1,4).Children = struct('Name', {}, ...
                    'Attributes', {}, ...
                    'Data', {}, ...
                    'Children', {});

                str(1,2).Children(1,k).Children(1,4).Children(1,2).Name = ...
                    'upperLeft';
                
                    str(1,2).Children(1,k).Children(1,4).Children(1,2).Attributes = struct('Name', {}, ...
                        'Value', {});

                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,2).Attributes(1,1).Name = 'x';
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,2).Attributes(1,1).Value = num2str(S.elements...
                        {j,1}.rect.upperLeft.x);
                    
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,2).Attributes(1,2).Name = 'y';
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,2).Attributes(1,2).Value = num2str(S.elements...
                        {j,1}.rect.upperLeft.y);
                    
                str(1,2).Children(1,k).Children(1,4).Children(1,4).Name = ...
                    'lowerRight';
                
                    str(1,2).Children(1,k).Children(1,4).Children(1,4).Attributes = struct('Name', {}, ...
                        'Value', {});

                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,4).Attributes(1,1).Name = 'x';
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,4).Attributes(1,1).Value = num2str(S.elements...
                        {j,1}.rect.lowerRight.x);
                    S.elements{j,1}.rect.lowerRight.x;
                    
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,4).Attributes(1,2).Name = 'y';
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,4).Attributes(1,2).Value = num2str(S.elements...
                        {j,1}.rect.lowerRight.y);   
                    S.elements{j,1}.rect.lowerRight.y;

                str(1,2).Children(1,k).Children(1,4).Children(1,6).Name = ...
                    'border';
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,6).Attributes.Name = 'pixel';
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,6).Attributes.Value = num2str(S.elements...
                        {j,1}.border);                    

                str(1,2).Children(1,k).Children(1,4).Children(1,8).Name = ...
                    'position';
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,8).Attributes.Name = 'p';
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,8).Attributes.Value = num2str(S.elements...
                        {j,1}.rectPosition); 
                    str(1,2).Children(1,k).Children(1,4).Children...
                        (1,8).Attributes.Value;
                    S.elements{j,1}.rectPosition;
end
theStruct = str;  
end